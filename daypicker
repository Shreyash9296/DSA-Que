// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DateFilter â€“ Style 1 Classic Red  (drop-in replacement)
//  â€¢ Centered modal overlay (fixed, above all content)
//  â€¢ Range selection: click start â†’ click end
//  â€¢ Red filled circles for start/end, light-red band for mid
//  â€¢ Matches the screenshot calendar exactly
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

import { useState, useEffect, useCallback } from "react";

/* â”€â”€â”€ Palette â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const RED       = "#C0392B";
const RED_DARK  = "#922B21";
const RED_BG    = "#fef2f2";
const RED_BAND  = "#fde8e8";
const RED_BORD  = "#fca5a5";

/* â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const MONTHS = [
  "January","February","March","April","May","June",
  "July","August","September","October","November","December",
];
const DAYS = ["Su","Mo","Tu","We","Th","Fr","Sa"];

function today0() {
  const d = new Date();
  d.setHours(0, 0, 0, 0);
  return d;
}

function sameDay(a, b) {
  return a && b && a.toDateString() === b.toDateString();
}

function fmt(d) {
  if (!d) return "";
  return d.toLocaleDateString("en-US", { month: "2-digit", day: "2-digit" });
}

function fmtLong(d) {
  if (!d) return "";
  return d.toLocaleDateString("en-US", {
    month: "short", day: "numeric", year: "numeric",
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CustomCalendar â€” pixel-accurate to screenshot
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function CustomCalendar({ value, onChange }) {
  const ref = value?.from || today0();
  const [view, setView] = useState({ y: ref.getFullYear(), m: ref.getMonth() });
  const [hovered, setHovered] = useState(null);

  const prev = () =>
    setView((v) => (v.m === 0 ? { y: v.y - 1, m: 11 } : { y: v.y, m: v.m - 1 }));
  const next = () =>
    setView((v) => (v.m === 11 ? { y: v.y + 1, m: 0 } : { y: v.y, m: v.m + 1 }));

  const firstDay     = new Date(view.y, view.m, 1).getDay();
  const daysInMonth  = new Date(view.y, view.m + 1, 0).getDate();
  const prevMonthDays= new Date(view.y, view.m, 0).getDate();

  /* Build grid cells */
  const cells = [];
  for (let i = 0; i < firstDay; i++) {
    cells.push({ date: new Date(view.y, view.m - 1, prevMonthDays - firstDay + 1 + i), outside: true });
  }
  for (let d = 1; d <= daysInMonth; d++) {
    cells.push({ date: new Date(view.y, view.m, d), outside: false });
  }
  while (cells.length % 7 !== 0) {
    cells.push({ date: new Date(view.y, view.m + 1, cells.length - daysInMonth - firstDay + 1), outside: true });
  }

  const rangeEnd = value?.to || (value?.from && hovered) || null;

  /* Classify a date for styling */
  const classify = (d) => {
    const t  = d.getTime();
    const isStart = value?.from && sameDay(d, value.from);
    const isEnd   = value?.to   && sameDay(d, value.to);
    const isToday = sameDay(d, today0());

    let isMid = false;
    if (value?.from) {
      const lo = value.from.getTime();
      const hi = rangeEnd ? rangeEnd.getTime() : lo;
      const [mn, mx] = lo < hi ? [lo, hi] : [hi, lo];
      isMid = t > mn && t < mx;
    }
    return { isStart, isEnd, isToday, isMid };
  };

  const handleClick = (date, outside) => {
    if (outside) return;
    const d = new Date(date);
    d.setHours(0, 0, 0, 0);

    if (!value?.from || (value.from && value.to)) {
      onChange({ from: d, to: undefined });
    } else {
      if (sameDay(d, value.from)) { onChange({ from: undefined, to: undefined }); return; }
      if (d < value.from) onChange({ from: d, to: value.from });
      else onChange({ from: value.from, to: d });
    }
  };

  const handleHover = (date, outside) => {
    if (outside || !value?.from || value?.to) return;
    const d = new Date(date);
    d.setHours(0, 0, 0, 0);
    setHovered(d);
  };

  const rows = [];
  for (let i = 0; i < cells.length; i += 7) rows.push(cells.slice(i, i + 7));

  return (
    <div style={{ userSelect: "none", width: "100%" }}>
      {/* â”€â”€ Navigation â”€â”€ */}
      <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "0 4px", marginBottom: 16 }}>
        <button onClick={prev} aria-label="Previous month" style={navBtnStyle}>â€¹</button>
        <span style={{ fontSize: "1.25rem", fontWeight: 700, color: "#1a1a1a" }}>
          {MONTHS[view.m]} {view.y}
        </span>
        <button onClick={next} aria-label="Next month" style={navBtnStyle}>â€º</button>
      </div>

      {/* â”€â”€ Weekday headers â”€â”€ */}
      <div style={{ display: "grid", gridTemplateColumns: "repeat(7,1fr)", marginBottom: 4 }}>
        {DAYS.map((d) => (
          <div key={d} style={{ textAlign: "center", fontSize: ".75rem", fontWeight: 600, color: "#9ca3af", padding: "4px 0" }}>
            {d}
          </div>
        ))}
      </div>

      {/* â”€â”€ Day grid â”€â”€ */}
      <div style={{ display: "flex", flexDirection: "column", gap: 2 }}>
        {rows.map((row, ri) => (
          <div key={ri} style={{ display: "grid", gridTemplateColumns: "repeat(7,1fr)" }}>
            {row.map(({ date, outside }, ci) => {
              const { isStart, isEnd, isToday, isMid } = classify(date);
              const isSelected = isStart || isEnd;

              /* Range band logic */
              const lo      = value?.from?.getTime();
              const hi      = rangeEnd?.getTime();
              const mn      = lo && hi ? Math.min(lo, hi) : null;
              const mx      = lo && hi ? Math.max(lo, hi) : null;
              const t       = date.getTime();
              const inRange = mn && mx && t >= mn && t <= mx;
              const showBand      = !outside && inRange && mn !== mx;
              const bandFull      = inRange && !isStart && !isEnd;
              const bandRight     = isStart && hi && hi > lo && !isEnd;
              const bandLeft      = isEnd   && lo && lo < hi && !isStart;
              const bandRightRev  = isStart && hi && hi < lo;
              const bandLeftRev   = isEnd   && lo && lo > hi;

              /* Day button style */
              let dayBg    = "transparent";
              let dayColor = outside ? "#d1d5db" : "#1a1a1a";
              let dayFw    = 400;
              let dayBox   = "none";

              if (isSelected)      { dayBg = RED_DARK; dayColor = "#fff"; dayFw = 700; }
              else if (isToday)    { dayBox = `0 0 0 2px ${RED}`; dayColor = RED; dayFw = 700; }
              else if (isMid)      { dayColor = RED_DARK; dayFw = 500; }

              return (
                <div
                  key={ci}
                  style={{ position: "relative", display: "flex", alignItems: "center", justifyContent: "center", height: 44 }}
                  onMouseEnter={() => handleHover(date, outside)}
                  onMouseLeave={() => setHovered(null)}
                >
                  {/* Band layers */}
                  {showBand && bandFull && (
                    <div style={bandStyle()} />
                  )}
                  {showBand && (bandRight || bandRightRev) && (
                    <div style={bandStyle("left")} />
                  )}
                  {showBand && (bandLeft || bandLeftRev) && (
                    <div style={bandStyle("right")} />
                  )}

                  <button
                    onClick={() => handleClick(date, outside)}
                    tabIndex={outside ? -1 : 0}
                    aria-label={date.toDateString()}
                    style={{
                      position: "relative", zIndex: 2,
                      width: 38, height: 38,
                      display: "flex", alignItems: "center", justifyContent: "center",
                      borderRadius: "50%", border: "none",
                      background: dayBg, color: dayColor,
                      fontWeight: dayFw, fontSize: ".9375rem",
                      cursor: outside ? "default" : "pointer",
                      boxShadow: dayBox,
                      transition: "background .15s, color .15s, transform .1s",
                      fontFamily: "inherit",
                    }}
                    onMouseEnter={(e) => {
                      if (!isSelected && !outside) {
                        e.currentTarget.style.background = RED_BG;
                        e.currentTarget.style.color = RED;
                        e.currentTarget.style.transform = "scale(1.08)";
                      }
                    }}
                    onMouseLeave={(e) => {
                      if (!isSelected && !outside) {
                        e.currentTarget.style.background = dayBg;
                        e.currentTarget.style.color = dayColor;
                        e.currentTarget.style.transform = "scale(1)";
                      }
                    }}
                  >
                    {date.getDate()}
                  </button>
                </div>
              );
            })}
          </div>
        ))}
      </div>
    </div>
  );
}

/* â”€â”€ Inline style helpers â”€â”€ */
const navBtnStyle = {
  background: "none", border: "none", cursor: "pointer",
  padding: "6px 10px", borderRadius: 8,
  color: RED, fontSize: 22, fontWeight: 300,
  lineHeight: 1, transition: "background .15s",
};

function bandStyle(side) {
  const base = {
    position: "absolute", top: "50%", height: 38,
    transform: "translateY(-50%)", zIndex: 1, pointerEvents: "none",
    background: RED_BAND,
    borderTop: `1.5px solid ${RED_BORD}`,
    borderBottom: `1.5px solid ${RED_BORD}`,
  };
  if (side === "left")  return { ...base, left: 0, right: "50%" };
  if (side === "right") return { ...base, left: "50%", right: 0 };
  return { ...base, left: 0, right: 0 };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DateFilter  â€” centered modal version
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
export default function DateFilter({ label, value, onChange, isOpen, onToggle }) {
  const hasValue = !!(value?.from || value?.to);
  const reset = () => onChange({ from: undefined, to: undefined });

  const summary =
    value?.from && value?.to
      ? `${fmtLong(value.from)} â€“ ${fmtLong(value.to)}`
      : "Select range";

  /* Close on Escape */
  useEffect(() => {
    if (!isOpen) return;
    const h = (e) => { if (e.key === "Escape") onToggle(); };
    document.addEventListener("keydown", h);
    return () => document.removeEventListener("keydown", h);
  }, [isOpen, onToggle]);

  /* Lock body scroll when open */
  useEffect(() => {
    document.body.style.overflow = isOpen ? "hidden" : "";
    return () => { document.body.style.overflow = ""; };
  }, [isOpen]);

  return (
    <>
      {/* â”€â”€ Toggle Button â”€â”€ */}
      <button
        onClick={onToggle}
        aria-expanded={isOpen}
        style={{
          display: "inline-flex", alignItems: "center", gap: 6,
          height: 32, padding: "0 12px", borderRadius: 6,
          border: `1.5px solid ${isOpen ? RED : "#d1d5db"}`,
          background: "#fff", cursor: "pointer", whiteSpace: "nowrap",
          fontSize: ".75rem", fontWeight: 600, color: "#374151",
          boxShadow: isOpen ? `0 0 0 3px ${RED}22` : "none",
          transition: "all .15s",
        }}
      >
        <span style={{ color: "#374151" }}>{label}</span>
        <span style={{ color: hasValue ? RED_DARK : "#9ca3af", fontWeight: hasValue ? 700 : 400 }}>
          {hasValue
            ? value.from && value.to
              ? `${fmt(value.from)} â€“ ${fmt(value.to)}`
              : "Partialâ€¦"
            : "Select range"}
        </span>
        {hasValue && (
          <span
            onClick={(e) => { e.stopPropagation(); reset(); }}
            title="Clear"
            style={{ color: "#9ca3af", cursor: "pointer", fontSize: 12, lineHeight: 1 }}
          >âœ•</span>
        )}
        {/* Chevron */}
        <svg
          width={14} height={14} viewBox="0 0 24 24" fill="none"
          stroke="#9ca3af" strokeWidth={2.5}
          style={{ transition: "transform .2s", transform: isOpen ? "rotate(180deg)" : "none" }}
        >
          <path d="M6 9l6 6 6-6" />
        </svg>
      </button>

      {/* â”€â”€ Backdrop + Modal â”€â”€ */}
      {isOpen && (
        <>
          {/* Backdrop */}
          <div
            onClick={onToggle}
            style={{
              position: "fixed", inset: 0, zIndex: 9998,
              background: "rgba(0,0,0,.22)",
              backdropFilter: "blur(2px)",
              animation: "calBackdropIn .15s ease",
            }}
          />

          {/* Modal card â€” centered */}
          <div style={{
            position: "fixed", zIndex: 9999,
            top: "50%", left: "50%",
            transform: "translate(-50%,-50%)",
            width: 380, maxWidth: "95vw",
            background: "#fff",
            border: "1px solid #e5e7eb",
            borderRadius: 16,
            padding: 20,
            boxShadow: "0 24px 64px rgba(0,0,0,.18), 0 4px 16px rgba(0,0,0,.1)",
            animation: "calModalIn .18s cubic-bezier(.34,1.2,.64,1)",
            overflow: "hidden",
          }}>

            {/* Header */}
            <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 14 }}>
              <div>
                <div style={{ fontSize: 10, fontWeight: 700, textTransform: "uppercase", letterSpacing: ".08em", color: "#9ca3af", marginBottom: 2 }}>
                  Date Range
                </div>
                <div style={{ fontSize: 14, fontWeight: 700, color: "#111827" }}>{label}</div>
              </div>
              <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                {hasValue && (
                  <button
                    onClick={reset}
                    style={{ fontSize: 12, fontWeight: 600, color: RED, border: "none", background: "none", cursor: "pointer" }}
                    onMouseEnter={(e) => e.target.style.color = RED_DARK}
                    onMouseLeave={(e) => e.target.style.color = RED}
                  >
                    Reset
                  </button>
                )}
                <button
                  onClick={onToggle}
                  style={{
                    width: 28, height: 28, borderRadius: 8, border: "none", cursor: "pointer",
                    fontSize: 14, display: "flex", alignItems: "center", justifyContent: "center",
                    background: "#f1f5f9", color: "#6b7280",
                  }}
                >âœ•</button>
              </div>
            </div>

            {/* Range chip */}
            {hasValue && value?.from && value?.to && (
              <div style={{
                display: "flex", alignItems: "center", gap: 8,
                padding: "7px 10px", borderRadius: 8, marginBottom: 14,
                fontSize: 12, fontWeight: 600,
                background: RED_BG, border: `1px solid ${RED_BORD}`, color: RED_DARK,
              }}>
                <span>ðŸ“…</span>
                <span>{summary}</span>
              </div>
            )}

            {/* Calendar */}
            <CustomCalendar value={value} onChange={onChange} />

            {/* Apply button */}
            <button
              onClick={() => { if (value?.from && value?.to) onToggle(); }}
              disabled={!value?.from || !value?.to}
              style={{
                marginTop: 16, width: "100%", padding: "10px 0",
                borderRadius: 10, border: "none",
                cursor: value?.from && value?.to ? "pointer" : "not-allowed",
                fontSize: 13, fontWeight: 700,
                background: value?.from && value?.to ? RED : "#e5e7eb",
                color: value?.from && value?.to ? "#fff" : "#9ca3af",
                boxShadow: value?.from && value?.to ? `0 3px 12px ${RED}44` : "none",
                transition: "all .15s",
                fontFamily: "inherit",
              }}
              onMouseEnter={(e) => { if (value?.from && value?.to) e.currentTarget.style.background = RED_DARK; }}
              onMouseLeave={(e) => { if (value?.from && value?.to) e.currentTarget.style.background = RED; }}
            >
              {value?.from && value?.to ? "âœ“ Apply Filter" : "Select start and end date"}
            </button>
          </div>

          {/* Keyframe styles injected once */}
          <style>{`
            @keyframes calBackdropIn { from{opacity:0} to{opacity:1} }
            @keyframes calModalIn {
              from { opacity:0; transform:translate(-50%,-48%) scale(.95) }
              to   { opacity:1; transform:translate(-50%,-50%) scale(1) }
            }
          `}</style>
        </>
      )}
    </>
  );
}

/*
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  USAGE in your existing Queue component:
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  import DateFilter from "./DateFilter_ClassicRed";

  // State
  const [submittedRange,  setSubmittedRange]  = useState({ from: undefined, to: undefined });
  const [approvedRange,   setApprovedRange]   = useState({ from: undefined, to: undefined });
  const [activeFilter,    setActiveFilter]    = useState(null);   // "sub" | "apr" | null

  const toggle = (name) => setActiveFilter((c) => (c === name ? null : name));

  // JSX (place inside your filter bar)
  <DateFilter
    label="Submitted Date"
    value={submittedRange}
    onChange={setSubmittedRange}
    isOpen={activeFilter === "sub"}
    onToggle={() => toggle("sub")}
  />

  <DateFilter
    label="Approved Date"
    value={approvedRange}
    onChange={setApprovedRange}
    isOpen={activeFilter === "apr"}
    onToggle={() => toggle("apr")}
  />

 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  iRange helper  (paste wherever you filter your rows):
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function iRange(date, range) {
    if (!range?.from || !range?.to) return true;
    if (!date) return false;
    const ts     = new Date(date).getTime();
    const fromTs = new Date(range.from).setHours(0, 0, 0, 0);
    const toTs   = new Date(range.to).setHours(23, 59, 59, 999);
    return ts >= fromTs && ts <= toTs;
  }
*/
